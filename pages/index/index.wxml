<!--pages/index/index.wxml-->
<view class="container">
  <!-- æœç´¢æ  -->
  <view class="search-container">
    <view class="search-box">
      <text class="search-icon">ğŸ”</text>
      <input class="search-input" 
             placeholder="æœç´¢è‚¡ç¥¨ä»£ç æˆ–åç§°" 
             value="{{searchKeyword}}" 
             bindinput="onSearchInput"
             bindconfirm="onSearchConfirm" />
      <view class="search-btn" bindtap="onSearchBtnTap">æœç´¢</view>
    </view>
  </view>

  <!-- æ±‡ç‡ä¿¡æ¯ -->
  <view class="exchange-rate-card card">
    <view class="rate-header">
      <text class="rate-title">æ¸¯å¸æ±‡ç‡</text>
      <text class="rate-time">{{exchangeRateTime}}</text>
    </view>
    <view class="rate-content">
      <text class="rate-value">1 HKD = {{exchangeRate}} CNY</text>
      <view class="refresh-btn" bindtap="refreshExchangeRate">
        <view class="refresh-icon"></view>
      </view>
    </view>
  </view>


  <!-- æœç´¢ç»“æœ -->
  <view wx:if="{{showSearchResults}}" class="search-results-section">
    <view class="section-header">
      <text class="section-title">æœç´¢ç»“æœ</text>
      <text class="clear-search" bindtap="clearSearch">æ¸…é™¤</text>
    </view>
    
    <view wx:if="{{searchLoading}}" class="loading">
      <text>æœç´¢ä¸­...</text>
    </view>
    
    <view wx:elif="{{searchResults.length === 0}}" class="empty-state">
      <text class="empty-text">æœªæ‰¾åˆ°ç›¸å…³è‚¡ç¥¨</text>
    </view>
    
    <view wx:else>
      <view wx:for="{{searchResults}}" wx:key="code" class="search-result-item" bindtap="addStockPair" data-stock="{{item}}">
        <view class="result-info">
          <text class="result-name">{{item.name}}</text>
          <text class="result-code">{{item.code}} / {{item.aCode}}</text>
          <view wx:if="{{item.hPrice}}" class="result-prices">
            <text class="result-price">Hè‚¡: {{item.hPrice}} HKD</text>
            <text class="result-price">Aè‚¡: {{item.aPrice}} CNY</text>
            <text class="result-premium">æº¢ä»·ç‡: {{item.premiumRate}}%</text>
          </view>
        </view>
        <view class="add-btn">æ·»åŠ </view>
      </view>
    </view>
  </view>

  <!-- è‚¡ç¥¨åˆ—è¡¨ -->
  <view class="stock-list">
    <view wx:if="{{loading}}" class="loading">
      <text>åŠ è½½ä¸­...</text>
    </view>
    
    <view wx:elif="{{stockPairs.length === 0 && !showSearchResults}}" class="empty-state">
      <text class="empty-icon">ğŸ“Š</text>
      <text class="empty-text">æš‚æ— è‚¡ç¥¨æ•°æ®\nç‚¹å‡»æœç´¢æ·»åŠ å…³æ³¨çš„è‚¡ç¥¨</text>
    </view>
    
    <view wx:else>
      <view wx:for="{{stockPairs}}" wx:key="id" class="stock-card" bindtap="goToDetail" data-stock="{{item}}">
        <!-- è‚¡ç¥¨å¤´éƒ¨ä¿¡æ¯ -->
        <view class="stock-header">
          <view class="stock-info">
            <text class="stock-name">{{item.name}}</text>
            <text class="stock-code">{{item.hCode}} / {{item.aCode}}</text>
          </view>
          <view class="favorite-btn" bindtap="toggleFavorite" data-stock="{{item}}" catchtap="">
            <text class="favorite-icon">{{item.isFavorite ? 'â­' : 'â˜†'}}</text>
          </view>
        </view>

        <!-- ä»·æ ¼ä¿¡æ¯ -->
        <view class="stock-prices">
          <view class="price-item">
            <text class="price-label">Hè‚¡ä»·æ ¼</text>
            <text class="price-value">{{item.hPrice}} HKD</text>
          </view>
          <view class="price-item">
            <text class="price-label">Aè‚¡ä»·æ ¼</text>
            <text class="price-value">{{item.aPrice}} CNY</text>
          </view>
        </view>

        <!-- æº¢ä»·ç‡ -->
        <view class="premium-rate">
          <text class="premium-label">HAæº¢ä»·ç‡</text>
          <text class="premium-value {{item.premiumRateClass}}">
            {{item.premiumRate >= 0 ? '+' : ''}}{{item.premiumRate}}%
          </text>
        </view>

        <!-- æ›´æ–°æ—¶é—´ -->
        <view class="update-time">
          <text>æ›´æ–°æ—¶é—´: {{item.updateTime}}</text>
        </view>
      </view>
    </view>
  </view>

</view>

<!-- æœç´¢ç»“æœå¼¹çª— -->
<view wx:if="{{showSearchModal}}" class="modal-overlay" bindtap="hideSearchModal">
  <view class="search-modal" catchtap="">
    <view class="modal-header">
      <text class="modal-title">æœç´¢è‚¡ç¥¨</text>
      <view class="close-btn" bindtap="hideSearchModal">
        <text class="close-icon">âœ•</text>
      </view>
    </view>
    
    <view class="search-content">
      <view class="search-input-container">
        <input class="modal-search-input" 
               placeholder="è¾“å…¥è‚¡ç¥¨ä»£ç æˆ–åç§°" 
               value="{{searchKeyword}}" 
               bindinput="onModalSearchInput"
               bindconfirm="searchStocks" />
        <view class="search-btn" bindtap="searchStocks">æœç´¢</view>
      </view>
      
      <!-- æœç´¢å†å² -->
      <view wx:if="{{searchHistory.length > 0 && searchResults.length === 0}}" class="search-history">
        <view class="history-header">
          <text class="history-title">æœç´¢å†å²</text>
          <text class="clear-history" bindtap="clearSearchHistory">æ¸…ç©º</text>
        </view>
        <view class="history-list">
          <text wx:for="{{searchHistory}}" wx:key="*this" 
                class="history-item" 
                bindtap="selectSearchHistory" 
                data-keyword="{{item}}">{{item}}</text>
        </view>
      </view>
      
      <!-- æœç´¢ç»“æœ -->
      <view wx:if="{{searchResults.length > 0}}" class="search-results">
        <view wx:for="{{searchResults}}" wx:key="code" 
              class="search-result-item" 
              bindtap="addStockPair" 
              data-stock="{{item}}">
          <view class="result-info">
            <text class="result-name">{{item.name}}</text>
            <text class="result-code">{{item.code}} / {{item.aCode}}</text>
          </view>
          <view class="add-btn">æ·»åŠ </view>
        </view>
      </view>
      
      <!-- æœç´¢çŠ¶æ€ -->
      <view wx:if="{{searchLoading}}" class="search-loading">
        <text>æœç´¢ä¸­...</text>
      </view>
      
      <view wx:if="{{searchKeyword && searchResults.length === 0 && !searchLoading}}" class="no-results">
        <text>æœªæ‰¾åˆ°ç›¸å…³è‚¡ç¥¨</text>
      </view>
    </view>
  </view>
</view>